<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kursy walut i z≈Çota</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- custom bootstrap-themed styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
<!-- NAVBAR ‚Äì FULL WIDTH + STICKY -->
<nav class="navbar navbar-expand-lg bg-white border-bottom py-3 fixed-top w-100">
  <div class="container-fluid px-4">

    <!-- LEWA STRONA ‚Äì LOGO -->
    <a class="navbar-brand fw-bold" href="#" style="font-size: 1.6rem;">
      NTWKinfo
    </a>

    <!-- HAMBURGER -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- ZAWARTO≈öƒÜ -->
    <div class="collapse navbar-collapse" id="mainNavbar">

      <!-- LINKI W ≈öRODKU -->
      <ul class="navbar-nav mx-auto mb-2 mb-lg-0 gap-lg-4">
        <li class="nav-item">
          <a class="nav-link" href="#">Wiadomo≈õci</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Ekonomia</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Pogoda</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">O nas</a>
        </li>
      </ul>

<!-- PRAWA STRONA -->
<div class="d-flex align-items-center gap-4 navbar-right">

  <div class="d-flex flex-column justify-content-center text-center" style="line-height: 1.2; min-width: 230px;">
    <div class="fw-semibold" style="font-size: 0.9rem;">
      28 stycznia, poniedzia≈Çek
    </div>
    <div class="text-success" style="font-size: 0.85rem;">
      Dzie≈Ñ Pamiƒôci Ofiar Re≈ºimu Hitlerowskiego
    </div>
  </div>

        <a href="#" class="btn btn-success rounded-pill px-4 py-2">
          Zaloguj siƒô
        </a>

      </div>
    </div>

  </div>
</nav>

<!-- DODAJ ODSTƒòP POD NAVBAREM, ≈ªEBY NIE ZACHODZI≈Å NA TRE≈öƒÜ -->
<div style="height: 95px;"></div>
<div class="container py-4">
    <h1 class="mb-4 header-title">üí± Kursy walut i cena z≈Çota</h1>

    <!-- Currency row: use Bootstrap row/cols but keep currency-box classes for CSS -->
<div class="currency-scroll">
    {% for waluta, kurs in kurs_walut.items() %}
    <div class="currency-item">
        <div class="card currency-box">
            <div class="card-body text-center">
                <div class="currency-title">{{ waluta }} to PLN</div>
                <div class="currency-value">{{ "%.2f" | format(kurs) }} z≈Ç</div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>


    <h2 class="mt-4 calc-heading">Kalkulator walut</h2>

    <!-- Calculator: Bootstrap layout, keeps original client-side logic -->
    <div class="d-flex flex-column flex-md-row align-items-center justify-content-center gap-4 calc-container mb-4">
        <div class="calc-box p-3">
            <form class="d-flex align-items-center flex-wrap">
                <div class="d-flex flex-column me-3 input-column">
                    <div class="input-group mb-2">
                        <input id="amount" type="text" class="form-control" placeholder="Kwota" aria-label="Kwota"
                               inputmode="decimal" pattern="[0-9]+([.,][0-9]+)?">
                    </div>
                    <div class="input-group">
                        <input id="result" type="text" class="form-control" placeholder="Przeliczona" aria-label="Wynik" readonly>
                    </div>
                </div>

                <div class="d-flex flex-column align-items-center" style="min-width:140px;">
                    <select id="currency-from" class="form-select mb-2" style="width:100%;">
                        <!-- PLN jako opcja oraz lista z serwera -->
                        <option value="PLN">PLN</option>
                        {% for code in currency_codes %}
                        <option value="{{ code }}">{{ code }}</option>
                        {% endfor %}
                    </select>
                    <!-- clickable swap button -->
                    <span id="swap-btn" role="button" title="Zamie≈Ñ" style="cursor:pointer; user-select:none;">üîÉ</span>
                    <select id="currency-to" class="form-select mt-2" style="width:100%;">
                        <option value="EUR">EUR</option>
                        {% for code in currency_codes %}
                        <option value="{{ code }}">{{ code }}</option>
                        {% endfor %}
                    </select>
                </div>

            </form>
        </div>

        <div class="text-center">
            <img src="data:image/png;base64,{{ wykres_waluty }}" alt="Wykres walut" class="currency-chart img-fluid">
        </div>
    </div>

    <h2 class="calc-heading">Cena z≈Çota dzi≈õ</h2>
    <p class="gold-price">{{ cena_zlota }} PLN/g</p>

    <h2 class="mt-4 calc-heading">Kurs z≈Çota [PLN] - widok w skali roku</h2>
    <div class="d-flex justify-content-center mb-4">
        <img src="data:image/png;base64,{{ wykres_zlota }}" alt="Wykres z≈Çota" class="gold-chart img-fluid" style="width:100%; max-width:1200px;">
    </div>
</div>

<!-- Client-side conversion script (przeniesione z oryginalnego index.html) -->
<script>
(function() {
    const RATES = {{ currency_rates | tojson | safe }};

    const amountEl = document.getElementById('amount');
    const fromEl = document.getElementById('currency-from');
    const toEl = document.getElementById('currency-to');
    const resultEl = document.getElementById('result');

    const PL_FORMATTER = new Intl.NumberFormat('pl-PL', {
        minimumFractionDigits: 0,
        maximumFractionDigits: 4
    });

    function compute() {
        const raw = amountEl.value.trim();
        if (raw === '') { resultEl.value = ''; return; }

        const hasTrailingSep = /[.,]$/.test(raw);
        const normalized = raw.replace(',', '.');
        const a = parseFloat(normalized);

        if (isNaN(a)) { resultEl.value = ''; return; }

        const from = fromEl.value || 'PLN';
        const to = toEl.value || 'PLN';

        const rateFrom = RATES[from] !== undefined ? RATES[from] : 1;
        const rateTo = RATES[to] !== undefined ? RATES[to] : 1;

        const inPln = a * rateFrom;
        const res = inPln / rateTo;

        let formatted = PL_FORMATTER.format(res);
        if (hasTrailingSep) {
            if (!formatted.includes(',')) {
                formatted = formatted + ',';
            } else if (formatted.endsWith(',')) {
                // already ends with comma
            } else {
                formatted = formatted + ',';
            }
        }

        resultEl.value = formatted;
    }

    function enforceTwoDecimals() {
        let raw = amountEl.value;
        if (!raw) return;

        // remember if user typed a trailing separator (dot or comma)
        const hadTrailingSep = /[.,]$/.test(raw);

        // remove any characters except digits and separators
        let s = raw.replace(/[^0-9.,]/g, '');

        // normalize commas to dot for processing
        let normalized = s.replace(/,/g, '.');

        // keep only the first dot, remove further dots
        const firstDot = normalized.indexOf('.');
        if (firstDot !== -1) {
            normalized = normalized.slice(0, firstDot + 1) + normalized.slice(firstDot + 1).replace(/\./g, '');
        }

        // limit to two decimal places if dot present
        if (normalized.indexOf('.') !== -1) {
            const [intPart, decPart = ''] = normalized.split('.');
            const dec = decPart.slice(0, 2);
            // if user had trailing separator, keep a trailing dot to indicate they typed it
            normalized = intPart + (dec.length > 0 ? '.' + dec : (hadTrailingSep ? '.' : ''));
        }

        // Update the input value (uses dot as separator for consistency in parsing)
        amountEl.value = normalized;
    }

    amountEl.addEventListener('input', function () { enforceTwoDecimals(); compute(); });
    fromEl.addEventListener('change', compute);
    toEl.addEventListener('change', compute);

    // Optional: button to trigger compute for users who click it
    document.querySelectorAll('.calc-box .btn').forEach(btn => btn.addEventListener('click', compute));

    // --- NEW: swap handler for the emoji ---
    const swapBtn = document.getElementById('swap-btn');
    if (swapBtn) {
        swapBtn.addEventListener('click', function() {
            const valFrom = fromEl.value;
            const valTo = toEl.value;

            // helper: ensure select contains option with given value
            function ensureOption(sel, val) {
                if (val === undefined || val === null || val === '') return;
                for (let i = 0; i < sel.options.length; i++) {
                    if (sel.options[i].value === val) return;
                }
                // add new option (label == value)
                const opt = new Option(val, val);
                sel.add(opt);
            }

            // ensure both selects can accept swapped values
            ensureOption(fromEl, valTo);
            ensureOption(toEl, valFrom);

            // perform swap
            fromEl.value = valTo;
            toEl.value = valFrom;

            // recompute result and focus amount
            compute();
            amountEl.focus();
        });
    }

    compute();
})();
</script>

<!-- FOOTER -->
<footer class="border-top py-3 mt-5">
  <div class="container-fluid px-4">

    <div class="d-flex justify-content-between align-items-center">

      <!-- LEWA STRONA: LUDZIK + TEXT -->
      <div class="d-flex align-items-center">

        <!-- TW√ìJ LUDZIK SVG -->
        <div style="height: 40px; display: flex; align-items: center;">
          <svg width="32" height="70" viewBox="0 0 32 70" fill="none" xmlns="http://www.w3.org/2000/svg" style="height: 100%;">
            <path d="M22.3379 21.5869L31.751 32.6748L27.9258 35.9121L22.3379 29.3125V45H24.8379V70H19.8379V45H17.3379V15H22.3379V21.5869ZM12.4248 44.999L7.83789 69.999H2.75L7.33789 44.999H12.4248ZM4.6748 35.8877L0 34.1123L7.22461 15H12.5752L4.6748 35.8877ZM17.3389 9.9502H12.3389V0H17.3389V9.9502Z" fill="black"/>
          </svg>
        </div>

        <!-- TEKST -->
        <span class="ms-3 footer-label" style="color: #5a6b2d; font-size: 0.9rem;">
          NTWKinfo&nbsp; 2025
        </span>

      </div>

      <!-- PRAWA STRONA -->
      <div class="footer-label" style="color: #5a6b2d; font-size: 0.9rem;">
        All Rights Reserved
      </div>

    </div>

  </div>
</footer>


<!-- Bootstrap JS bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
